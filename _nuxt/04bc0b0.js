(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{434:function(t,n){const e={render:function(){var t=this;t.$createElement;return t._self._c,t._m(0)},staticRenderFns:[function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"frontmatter-markdown"},[e("h2",{attrs:{id:"viper在gin框架的使用"}},[t._v("viper在gin框架的使用")]),t._v(" "),e("h3",{attrs:{id:"viper简介"}},[t._v("viper简介")]),t._v(" "),e("p",[t._v("Viper是适用于Go应用程序（包括"),e("code",{pre:!0},[t._v("Twelve-Factor App")]),t._v("）的完整配置解决方案。它被设计用于在应用程序中工作，并且可以处理所有类型的配置需求和格式。它支持以下特性：")]),t._v(" "),e("ul",[e("li",[t._v("设置默认值")]),t._v(" "),e("li",[t._v("从"),e("code",{pre:!0},[t._v("JSON")]),t._v("、"),e("code",{pre:!0},[t._v("TOML")]),t._v("、"),e("code",{pre:!0},[t._v("YAML")]),t._v("、"),e("code",{pre:!0},[t._v("HCL")]),t._v("、"),e("code",{pre:!0},[t._v("envfile")]),t._v("和"),e("code",{pre:!0},[t._v("Java properties")]),t._v("格式的配置文件读取配置信息")]),t._v(" "),e("li",[t._v("实时监控和重新读取配置文件（可选）")]),t._v(" "),e("li",[t._v("从环境变量中读取")]),t._v(" "),e("li",[t._v("从远程配置系统（etcd或Consul）读取并监控配置变化")]),t._v(" "),e("li",[t._v("从命令行参数读取配置")]),t._v(" "),e("li",[t._v("从buffer读取配置")]),t._v(" "),e("li",[t._v("显式配置值")])]),t._v(" "),e("h3",{attrs:{id:"viper能做什么"}},[t._v("viper能做什么")]),t._v(" "),e("p",[t._v("Viper能够为你执行下列操作：")]),t._v(" "),e("ol",[e("li",[t._v("查找、加载和反序列化"),e("code",{pre:!0},[t._v("JSON")]),t._v("、"),e("code",{pre:!0},[t._v("TOML")]),t._v("、"),e("code",{pre:!0},[t._v("YAML")]),t._v("、"),e("code",{pre:!0},[t._v("HCL")]),t._v("、"),e("code",{pre:!0},[t._v("INI")]),t._v("、"),e("code",{pre:!0},[t._v("envfile")]),t._v("和"),e("code",{pre:!0},[t._v("Java properties")]),t._v("格式的配置文件。")]),t._v(" "),e("li",[t._v("提供一种机制为你的不同配置选项设置默认值。")]),t._v(" "),e("li",[t._v("提供一种机制来通过命令行参数覆盖指定选项的值。")]),t._v(" "),e("li",[t._v("提供别名系统，以便在不破坏现有代码的情况下轻松重命名参数。")]),t._v(" "),e("li",[t._v("当用户提供了与默认值相同的命令行或配置文件时，可以很容易地分辨出它们之间的区别。")])]),t._v(" "),e("p",[t._v("Viper会按照下面的优先级。每个项目的优先级都高于它下面的项目:")]),t._v(" "),e("ul",[e("li",[t._v("显示调用"),e("code",{pre:!0},[t._v("Set")]),t._v("设置值")]),t._v(" "),e("li",[t._v("命令行参数（flag）")]),t._v(" "),e("li",[t._v("环境变量")]),t._v(" "),e("li",[t._v("配置文件")]),t._v(" "),e("li",[t._v("key/value存储")]),t._v(" "),e("li",[t._v("默认值")])]),t._v(" "),e("h3",{attrs:{id:"安装"}},[t._v("安装")]),t._v(" "),e("p",[e("code",{pre:!0},[t._v('"go get github.com/spf13/viper"')])]),t._v(" "),e("h3",{attrs:{id:"详细了解"}},[t._v("详细了解")]),t._v(" "),e("p",[t._v("https://github.com/spf13/viper "),e("strong",[t._v("真的很详细")])]),t._v(" "),e("h3",{attrs:{id:"实例"}},[t._v("实例")]),t._v(" "),e("pre",{staticClass:"language-go"},[e("code",{pre:!0,attrs:{class:"language-go"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/fsnotify/fsnotify"')]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/gin-gonic/gin"')]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/spf13/viper"')]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"net/http"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//viper.SetConfigFile("./gin_viper/") // 指定配置文件路径')]),t._v("\n\tviper"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetConfigName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"config"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("      "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 配置文件名称(无扩展名)")]),t._v("\n\tviper"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetConfigType")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yaml"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果配置文件的名称中没有扩展名，则需要配置此项")]),t._v("\n\tviper"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddConfigPath")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./gin_viper"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 查找配置文件所在的路径")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" viper"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("ReadInConfig")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ok "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" err"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("viper"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ConfigFileNotFoundError"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" ok "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 配置文件未找到错误；如果需要可以忽略")]),t._v("\n\t\t\tfmt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('" err.(viper.ConfigFileNotFoundError) is fail"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 配置文件被找到，但产生了另外的错误")]),t._v("\n\t\t\tfmt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"viper.ReadInConfig() is fail"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\tviper"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("WatchConfig")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tviper"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("OnConfigChange")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e fsnotify"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Event"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 配置文件发生变更之后会调用的回调函数")]),t._v("\n\t\tfmt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Config file changed:"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\n\t"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Init")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Init")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tengine "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" gin"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Default")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\tengine"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GET")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("gin"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tcontext"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("String")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("http"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("StatusOK"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" viper"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetString")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mysql.port"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当你修改配置文件时，会自动修改，热配置")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tengine"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Run")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])}]};t.exports={attributes:{title:"Gin_Viper",description:"viper在gin框架的使用"},vue:{render:e.render,staticRenderFns:e.staticRenderFns,component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=e.render,this.$options.staticRenderFns=e.staticRenderFns}}}}}}]);