(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{423:function(t,e){const n={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"frontmatter-markdown"},[n("h1",{attrs:{id:"文件上传"}},[t._v("文件上传")]),t._v(" "),n("h2",{attrs:{id:"黑白名单"}},[t._v("黑白名单")]),t._v(" "),n("p",[t._v("黑名单：黑名单是一个列表，在黑名单列表里面记录的内容（人、手机号、ip等）或被限制或禁止执行一些操作。")]),t._v(" "),n("p",[t._v("白名单：白名单与黑名单相对，也是一个列表，只有在白名单列表里的内容（人、手机号、ip等）才可以执行一些操作，不在白名单记录的内容（人、手机号、ip等）则会被禁止执行操作。")]),t._v(" "),n("p",[t._v("文件上传漏洞黑名单：")]),t._v(" "),n("p",[t._v("某些网站禁止用户上传扩展名为 .asp .php .aspx .jsp 的文件， .asp .php .aspx .jsp 这个列表就叫做黑名单。")]),t._v(" "),n("p",[t._v("文件上传漏洞白名单：")]),t._v(" "),n("p",[t._v("某些网站只允许用户上传扩展名为 .png .jpg .gif 的文件， .png .jpg .gif 这个列表就叫做白名单。")]),t._v(" "),n("h2",{attrs:{id:"mime绕过"}},[t._v("MIME绕过")]),t._v(" "),n("p",[t._v("MIME：（Multipurpose Internet Mail Extensions），MIME是一种标准，用来表示文档、文件或字节流的性质和格式。")]),t._v(" "),n("p",[t._v("![]](./_img/1.png)")]),t._v(" "),t._m(0),t._v(" "),t._m(1),t._v(" "),n("h2",{attrs:{id:"特殊扩展名绕过"}},[t._v("特殊扩展名绕过")]),t._v(" "),t._m(2),t._v(" "),n("h2",{attrs:{id:"hataccess绕过"}},[t._v("hataccess绕过")]),t._v(" "),n("p",[t._v(".htaccess文件 (或者“分布式配置文件”）,全称是 Hypertext Access(超文本口)。提供了针对目录改变配置的方法，即在一个特定的文档目录中放置一个包含一个或多个指令的文件，以作用于此目录及其所有子目录。作为用户，所能使用的命令受到限制。管理员可以通过 Apache的AllowOverride指令来设置。")]),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),n("h2",{attrs:{id:"大小写绕过"}},[t._v("大小写绕过")]),t._v(" "),t._m(5),t._v(" "),n("h2",{attrs:{id:"空格绕过"}},[t._v("空格绕过")]),t._v(" "),n("p",[t._v('在Windows中，文件首位如果有空格，系统会默认去除。如："example.php    " 文件会被修改成：“example.php”')]),t._v(" "),t._m(6),t._v(" "),n("h2",{attrs:{id:"点号绕过"}},[t._v("点号绕过")]),t._v(" "),t._m(7),t._v(" "),n("h2",{attrs:{id:"点空格点绕过"}},[t._v("点+空格+点绕过")]),t._v(" "),t._m(8),t._v(" "),n("p",[t._v("构造 点 空格 点 即可进行绕过")]),t._v(" "),n("h2",{attrs:{id:"特殊字符data绕过"}},[t._v("特殊字符::$DATA绕过")]),t._v(" "),n("p",[n("strong",[t._v("在 window的时候如果文件名+“::"),n("mjx-container",{staticClass:"MathJax",staticStyle:{direction:"ltr"},attrs:{jax:"SVG"}},[n("svg",{staticStyle:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.452ex"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"14.515ex",height:"2.149ex",role:"img",focusable:"false",viewBox:"0 -750 6415.8 950"}},[n("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"}},[n("g",{attrs:{"data-mml-node":"math"}},[n("g",{attrs:{"data-mml-node":"mi"}},[n("path",{staticStyle:{"stroke-width":"3"},attrs:{"data-c":"1D437",d:"M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"}})]),n("g",{attrs:{"data-mml-node":"mi",transform:"translate(828,0)"}},[n("path",{staticStyle:{"stroke-width":"3"},attrs:{"data-c":"1D434",d:"M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"}})]),n("g",{attrs:{"data-mml-node":"mi",transform:"translate(1578,0)"}},[n("path",{staticStyle:{"stroke-width":"3"},attrs:{"data-c":"1D447",d:"M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"}})]),n("g",{attrs:{"data-mml-node":"mi",transform:"translate(2282,0)"}},[n("path",{staticStyle:{"stroke-width":"3"},attrs:{"data-c":"1D434",d:"M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"}})]),n("g",{attrs:{"data-mml-node":"TeXAtom","data-mjx-texclass":"ORD",transform:"translate(3032,0)"}},[n("g",{attrs:{"data-mml-node":"mo"}},[n("g",{attrs:{"data-c":"2033"}},[n("path",{staticStyle:{"stroke-width":"3"},attrs:{"data-c":"2032",d:"M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"}}),n("path",{staticStyle:{"stroke-width":"3"},attrs:{"data-c":"2032",d:"M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z",transform:"translate(275,0)"}})])])]),n("g",{attrs:{"data-mml-node":"mi",transform:"translate(3582,0)"}},[n("text",{attrs:{"data-variant":"normal",transform:"scale(1,-1)","font-size":"884px","font-family":"serif"}},[t._v("会")])]),n("g",{attrs:{"data-mml-node":"mi",transform:"translate(4582,0)"}},[n("text",{attrs:{"data-variant":"normal",transform:"scale(1,-1)","font-size":"884px","font-family":"serif"}},[t._v("把")])]),n("g",{attrs:{"data-mml-node":"mo",transform:"translate(5859.8,0)"}},[n("g",{attrs:{"data-mml-node":"text"}},[n("path",{staticStyle:{"stroke-width":"3"},attrs:{"data-c":"3A",d:"M78 370Q78 394 95 412T138 430Q162 430 180 414T199 371Q199 346 182 328T139 310T96 327T78 370ZM78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"}})]),n("g",{attrs:{"data-mml-node":"text",transform:"translate(278,0)"}},[n("path",{staticStyle:{"stroke-width":"3"},attrs:{"data-c":"3A",d:"M78 370Q78 394 95 412T138 430Q162 430 180 414T199 371Q199 346 182 328T139 310T96 327T78 370ZM78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"}})])])])])])]),t._v('DATA之后的数据当成文件流处理,不会检测后缀名，且保持”::$DATA"之前的文件名他的目的就是不检查后缀名。')],1)]),t._v(" "),n("p",[t._v("如：a.php::$DATA 与 a.php 等价")]),t._v(" "),n("h2",{attrs:{id:"双写绕过"}},[t._v("双写绕过")]),t._v(" "),t._m(9),t._v(" "),n("p",[t._v("如果后端服务器在验证扩展名时，没有递归替换扩展名的话，可以使用双写扩展名的方式进行绕过。")]),t._v(" "),n("h2",{attrs:{id:"00截断-get"}},[t._v("00截断-GET")]),t._v(" "),t._m(10),t._v(" "),n("p",[t._v("可以构造名字带有%00木马上传，进行绕过。")]),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),n("h2",{attrs:{id:"00截断-post"}},[t._v("00截断-POST")]),t._v(" "),t._m(13),t._v(" "),n("h1",{attrs:{id:"waf及disable_function绕过"}},[t._v("WAF及disable_function绕过")]),t._v(" "),n("h2",{attrs:{id:"waf绕过思路"}},[t._v("WAF绕过思路")]),t._v(" "),t._m(14),t._v(" "),n("p",[t._v("如果WAF接收的数据包长度过长，可能会把部分数据包或者是数据包的部分内容进行无检测“放行”")]),t._v(" "),n("p",[t._v("如果站点的流量过大，为了保证网站的可用性，WAF可能会放弃对部分数据包的检测")]),t._v(" "),t._m(15),t._v(" "),n("p",[t._v("WAF在进行检测拦截的时候，一般比较死板。类似双写绕过、大小写绕过等方式都是基于此思路绕过")]),t._v(" "),n("h2",{attrs:{id:"常见绕过方法"}},[t._v("常见绕过方法")]),t._v(" "),n("p",[t._v("根据以上的绕过思路，并针对文件上传漏洞，可以派生出以下几种绕过方法（适用于upload-labs）")]),t._v(" "),t._m(16),t._v(" "),n("h2",{attrs:{id:"disable_function绕过"}},[t._v("disable_function绕过")]),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),n("h2",{attrs:{id:"disable_function绕过-1"}},[t._v("disable_function绕过")]),t._v(" "),t._m(21),t._v(" "),n("p",[t._v("在windows中，PHP开发一般会启动一个扩展组件：php_com_dotnet")]),t._v(" "),t._m(22),t._v(" "),n("h2",{attrs:{id:"蚁剑自动绕过"}},[t._v("蚁剑自动绕过")]),t._v(" "),t._m(23),t._v(" "),n("h1",{attrs:{id:"文件解析漏洞利用"}},[t._v("文件解析漏洞利用")]),t._v(" "),n("h2",{attrs:{id:"图片马的制作与利用"}},[t._v("图片马的制作与利用")]),t._v(" "),t._m(24),t._v(" "),t._m(25),t._v(" "),n("h2",{attrs:{id:"条件竞争绕过"}},[t._v("条件竞争绕过")]),t._v(" "),n("p",[t._v("条件竞争是代码逻辑存在问题，代码执行逻辑为：服务器先将上传的文件保存在临时目录中，然后再对后缀名进行白名单验证。如果符合白名单的要求，并重命名，但如果不符合白名单的要求，就会被删除掉。")]),t._v(" "),t._m(26),t._v(" "),t._m(27),t._v(" "),n("h2",{attrs:{id:"apache-httpd解析漏洞"}},[t._v("Apache HTTPD解析漏洞")]),t._v(" "),n("p",[t._v("Apache HTTPD 支持一个文件拥有多个后缀，并为不同后缀执行不同的指令。")]),t._v(" "),n("p",[t._v("在有多个后缀的情况下，只要一个文件含有.php后缀的文件即将被识别成PHP文件，没必要是最后一个后缀。")]),t._v(" "),n("p",[t._v("如：a.php.jpg 文件会被当成 php文件执行")]),t._v(" "),n("p",[t._v("利用这个特性，将会造成一个可以绕过上传白名单的解析漏洞。")]),t._v(" "),n("h2",{attrs:{id:"nginx-解析漏洞"}},[t._v("Nginx 解析漏洞")]),t._v(" "),n("h1",{attrs:{id:"文件包含漏洞"}},[t._v("文件包含漏洞")]),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),n("h4",{attrs:{id:"包含脚本"}},[t._v("包含脚本")]),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),t._v(" "),t._m(34),t._v(" "),t._m(35),t._v(" "),t._m(36),t._v(" "),t._m(37),t._v(" "),n("h4",{attrs:{id:"漏洞类型"}},[t._v("漏洞类型")]),t._v(" "),t._m(38),t._v(" "),n("p",[t._v("本地包含文件需要指定目标服务器本地的一个文件。")]),t._v(" "),t._m(39),t._v(" "),n("p",[t._v("http://127.0.0.1?filename=xxx.txt")]),t._v(" "),t._m(40),t._v(" "),n("p",[t._v("http://127.0.0.1?filename=…/…/…/xxx.txt")]),t._v(" "),t._m(41),t._v(" "),t._m(42),t._v(" "),n("p",[t._v("00截断")]),t._v(" "),n("p",[t._v("条件：php<5.3.4  magic_quotes_gpc = Off")]),t._v(" "),n("p",[t._v("http://127.0.0.1/?filename=xxx.txt%00")]),t._v(" "),t._m(43),t._v(" "),n("p",[t._v("代码会进行限制：allow_url_include = On")]),t._v(" "),n("p",[t._v("远程文件包含需要指定一个远程文件的地址，这个地址我们可以自己构造。")]),t._v(" "),t._m(44),t._v(" "),n("p",[t._v("（phpstudy可以构建远程地址）")]),t._v(" "),t._m(45),t._v(" "),n("p",[t._v("原理：")]),t._v(" "),n("p",[t._v("http://127.0.0.1/xxx.txt?.html")]),t._v(" "),n("p",[t._v("http://127.0.0.1/xxx.txt#.html")]),t._v(" "),n("p",[t._v("加了问号或者#号（%23编码就是#号），再访问链接显示的还是原来的页面")]),t._v(" "),n("h4",{attrs:{id:"协议流绕过"}},[t._v("协议流绕过")]),t._v(" "),t._m(46),t._v(" "),t._m(47),t._v(" "),t._m(48),t._v(" "),n("p",[t._v("读取文件：")]),t._v(" "),t._m(49),t._v(" "),t._m(50),t._v(" "),t._m(51),t._v(" "),t._m(52),t._v(" "),t._m(53),t._v(" "),t._m(54),t._v(" "),t._m(55),t._v(" "),t._m(56),t._v(" "),n("p",[t._v("读取数据流")]),t._v(" "),t._m(57),t._v(" "),t._m(58)])},staticRenderFns:[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("服务器在检测上传的图片时，可能会检测文件的MIME类型。")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("此类检测可以通过修改MIME进行绕过")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("由于历史原因，部分解释器可能支持符合正则 /ph(p[2-7]?|t(ml)?)/ 的后缀，如 php / php5 / pht / phtml / shtml / pwml / phtm 等 可在禁止上传php文件时测试该类型。")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v(".htaccess在文件上传中最大作用就是 可以使任何类型文件作为 php解析，该文件在 Apache里默认是启用的。")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("blockquote",[n("p",[t._v("#任何格式都用php解释")]),t._v(" "),n("p",[t._v("SetHandler application/x-httpd-php")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("网站在过滤扩展名时，如果没有将字符串统一大小写后再进行比较的话，可以通过修改扩展名大小写的方式绕过。")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v('但是在WAF字符串匹配时，".php    " 与 ".php"匹配不成功，即可绕过')])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("在windows中，文件名最末尾的 点不会被解析")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("PHP中的 deldot()函数会删除字符串中的点，但是该函数检测到末尾的第一个点之后，会删除，并且继续检测。如果遇到空格则会停止删除。")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("PHP中 str_ireplace(find,replace,string,count) 函数替换字符串中的一些字符（不区分大小写）且只能去除一次。")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("php的一些函数的底层是 C语言，C语言的字符串中，如果遇到0x00会被编译器认为是字符串结束标志，会把该字符串截断。0x表示 16进制，URL中%00解码成 16进制就是 0x00。")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("php 版本 <5.3.4 才可以进行00截断")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("magic_quotes_gpc = Off")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("同理")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",[n("li",[n("strong",[t._v("增加WAF负担")])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",[n("li",[n("strong",[t._v("构造异常数据包")])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",[n("li",[n("p",[t._v("垃圾数据绕过")])]),t._v(" "),n("li",[n("p",[t._v("特殊符号绕过")]),t._v(" "),n("p",[t._v("推测安全狗在进行匹配的时候，使用的是单引号或者是双引号进行匹配，取一个闭合引号中间的内容")])]),t._v(" "),n("li",[n("p",[t._v("截断绕过")])]),t._v(" "),n("li",[n("p",[t._v("重复数据绕过")])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("PHP的危险函数比较多，稍微不注意就有可能导致漏洞产生。而且如果网站中被上传了webshell的话，webshell中也会调用类似system的函数来执行系统命令。")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("disable_function可以用于限制，网站中的某些函数，在disable_function列表中的函数会被禁止执行。即使网站中存在webshell，也会导致webshell不能发挥其功能。")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("disable_function")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("在对应php版本中的 php.ini文件中设置")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("com组件绕过")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",{staticClass:"language-php"},[n("code",{pre:!0,attrs:{class:"language-php"}},[t._v("绕过代码：\n"),n("span",{pre:!0,attrs:{class:"token php language-php"}},[n("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$command")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token global"}},[t._v("$_GET")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'a'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$wsh")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("COM")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'WScript.shell'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$exec")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$wsh")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("exec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"cmd /c "')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$studio")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$exec")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("StdOut")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$out")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$StdOut")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ReadAll")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$out")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("?>")])]),t._v("\n  访问 http://127.0.0.1/a.php?a=calc ，此时电脑上面会弹出一个计算器\n")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("disable——function 插件")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[t._v("图片马就是在图片中隐藏一句话木马，使用正常的图片上传功能将该图片马上传至服务器后，再利用"),n("strong",[t._v("htaccess")]),t._v("、"),n("strong",[t._v("文件包含漏洞")]),t._v("或者"),n("strong",[t._v("解析漏洞")]),t._v("即可发挥作用。")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("注：单纯的上传图片马并不会发挥作用，必须配合其他漏洞。")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("代码删除文件是需要耗费时间的，如果我们能够在文件被删除之前就访问到了此文件，那么即使删除了也无所谓。这个过程就叫做条件竞争。")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",{staticClass:"language-python"},[n("code",{pre:!0,attrs:{class:"language-python"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" requests \nurl "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://ip:端口/upload/shell.php"')]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  requests"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("文件包含函数加载的参数没有经过过滤或者严格的定义，可以被用户控制，包含其他恶意文件，导致了执行了非预期的代码。")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",{staticClass:"language-php"},[n("code",{pre:!0,attrs:{class:"language-php"}},[n("span",{pre:!0,attrs:{class:"token php language-php"}},[n("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$filename")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token global"}},[t._v("$_GET")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'filename'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("include")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$filename")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("?>")])]),t._v("\n  $_GET['filename']\n  参数开发者没有经过严格的过滤，直接带入了include的函数，攻击者可以修改的值，执行非预期的操作。\n\n")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("Php")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",{staticClass:"language-php"},[n("code",{pre:!0,attrs:{class:"language-php"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("include")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'xx.php'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用该函数包含文件")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("include_one")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'xxx.php'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//功能与include相同，当时当程序重复调用同一个文件时，只会调用一次")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'xxx.php'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// require 和 include()类似，但是require()调用的文件发生错误时，程序会输出错误信息，并终止脚本执行")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require_one")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'xxx.php'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// require()相同，但是当程序重复调用同一个文件时，只会调用一次。")]),t._v("\n\n")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("asp")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",{staticClass:"language-bash"},[n("code",{pre:!0,attrs:{class:"language-bash"}},[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("--"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#include file="xxx.asp"--\x3e')]),t._v("\n")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("Aspx")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",{staticClass:"language-bash"},[n("code",{pre:!0,attrs:{class:"language-bash"}},[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("--"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#include file="xxx.aspx"--\x3e')]),t._v("\n")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("Jsp")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",{staticClass:"language-bash"},[n("code",{pre:!0,attrs:{class:"language-bash"}},[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("%@ include "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("file")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxx.jsp"')]),t._v("%"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("jsp:include "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("page")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxx.jsp"')]),t._v("/"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("本地文件包含")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("无限制直接包含")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("包含计算机上的其他文件")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("限制扩展名的包含")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",{staticClass:"language-php"},[n("code",{pre:!0,attrs:{class:"language-php"}},[n("span",{pre:!0,attrs:{class:"token php language-php"}},[n("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("  \n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$filename")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token global"}},[t._v("$_GET")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'file'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("include")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$filename")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('".html"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("?>")])]),t._v("\n")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("远程文件包含")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("file=网址")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("有后缀限制")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("php协议")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[n("code",{pre:!0},[t._v("php://filter")])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("php://filter 是php中独有的一个协议，可以作为一个中间流来处理其他流，可以进行任意文件的读取。")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("blockquote",[n("p",[t._v("php://filter/read=convert.base64-encode/resource=index.php")]),t._v(" "),n("p",[t._v("读取上级目录文件：")]),t._v(" "),n("p",[t._v("php://filter/read=convert.base64-encode/resource=…/…/…/a.txt")]),t._v(" "),n("p",[t._v("读取其他的文件")]),t._v(" "),n("p",[t._v("php://filter/read=convert.base64-encode/resource=F:\\b.txt")]),t._v(" "),n("p",[t._v("需要base64解码")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("code",{pre:!0},[t._v("php://input")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("将post请求中的数据作为PHP代码执行，回显出现在header中")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("blockquote",[n("p",[t._v("http://127.0.0.1/?file=php://input")]),t._v(" "),n("p",[t._v("发送post请求，请求内容为要执行的PHP代码")]),t._v("\n<?php fputs(fopen('shell.php','w'),'<?php @eval($_POST[1]); phpinfo(); ?>'); ?>\n")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("file协议")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("访问本地文件系统，所有语言都支持，file协议需要传入绝对路径（完整路径）。")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("blockquote",[n("p",[t._v("注意读取linux文件是：")]),t._v(" "),n("p",[t._v("file:///etc/passwd")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("data协议")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",[n("li",[n("p",[t._v("allow_url_fopen ：on")])]),t._v(" "),n("li",[n("p",[t._v("allow_url_include：on")])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("blockquote",[n("p",[t._v("data://text/plaindata://text/plain,<?php%20phpinfo()?>")]),t._v(" "),n("p",[t._v("以base64的形式，执行")]),t._v("\n<?php phpinfo()?>  base64编码=>  PD9waHAgcGhwaW5mbygpPz4=data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=\n")])}]};t.exports={attributes:{title:"File Upload",description:"文件上传"},vue:{render:n.render,staticRenderFns:n.staticRenderFns,component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=n.render,this.$options.staticRenderFns=n.staticRenderFns}}}}}}]);